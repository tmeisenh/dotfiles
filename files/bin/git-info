#!/usr/bin/env bash
# Script that provides some fun git commit information
# Accepts comma-separated emails for authors with multiple addresses

authors="${1:?Usage: git-info <author|email1,email2,...>}"

# Convert comma-separated list to git author regex pattern
author_pattern="${authors//,/\\|}"

git log --shortstat --author="${author_pattern}" | \
  grep -E "files? changed" | \
  awk '{
    files+=$1; inserted+=$4; deleted+=$6
  } END {
    delta = inserted - deleted
    ratio = (inserted > 0) ? deleted/inserted : 0
    printf "Commit stats:\n"
    printf "- Files changed (total)..  %s\n", files
    printf "- Lines added (total)....  %s\n", inserted
    printf "- Lines deleted (total)..  %s\n", deleted
    printf "- Total lines (delta)....  %s\n", delta
    printf "- Add./Del. ratio (1:n)..  1 : %.2f\n", ratio
  }'
